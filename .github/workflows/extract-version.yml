name: Extract Version Info

on:
  push:
    tags:
      - '*'

jobs:
  extract-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install dependencies
        run: npm ci

      - uses: ./packages/github-actions
        with:
          command: build-app

      - name: Build
        run: npm run build --workspace=@minotaur-ergo/github-actions && npm i

      - name: Extract Version Info
        uses: ./packages/github-actions/.github/actions/extract-versions
        with:
          version_prefix: '## '
          changelog_path: './services/test/CHANGELOG.md'
          error_on_failure: 'true'

      - name: Build Minotaur App
        uses: ./packages/github-actions/.github/actions/build-app
        with:
          node-version: '22'

      - name: Display extracted info
        run: |
          echo "Major: $MAJOR"
          echo "Minor: $MINOR"
          echo "Patch: $PATCH"
          echo "Pre-release: $PRE_RELEASE"
          echo "Number of commits: $NUMBER_OF_COMMITS"
          echo "Changelog: \n$CHANGE_LOG"

